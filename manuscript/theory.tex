% !TEX root =  CCmoments.tex

\section{Recursive Techniques for Generating Canonical Partition Functions}\label{sec:theoryexact}

For non-interacting particles the canonical partition function can be calculated exactly, or at least to the level that all partitions of $A\le A_{\rm max}$ hadrons are taken into account, with the exact solution being reached at $A_{\rm max}=\infty$. For our case, we conserve three quantities: the electric charge $Q$, the baryon number $B$ and the strangeness $S$. For states $i$ with energies $E_i$, the partition function,
\begin{eqnarray}
Z(Q,B,S)&=&\sum_{i,Q_i=Q,B_i=B,S_i=S}e^{-\beta E_i},
\end{eqnarray}
where $Q_i,B_i$ and $S_i$ are the discrete values of the conserved quantities for the state $i$, can be calculated recursively. The function $Z_A(Q,B,S)$ refers to the subset of states with $A$ hadrons,
\begin{eqnarray}
Z(Q,B,S)&=&\sum_{A\ge 0}Z_A(Q,B,S).
\end{eqnarray}
The recursive procedure begins with
\begin{eqnarray}
Z_{A=0}(0,0,0)&=&1,
\end{eqnarray}
the canonical partition function of the vacuum. The contribution for a given $A$, $Z_A(Q,B,S)$, can be written as 
\begin{eqnarray}\label{eq:recurrence}
Z_A(Q,B,S)&=&\frac{1}{A}\sum_h z_hZ_{A-1}(Q-q_h,B-b_h,S-s_h),
\end{eqnarray}
where $z_h$ is the single-particle partition function for hadron species $h$, which has charges $q_h,b_h$ and $s_h$. This was proved in \cite{Pratt:1999ht}, and can be understood by realizing that one can count all the ways to arrange $A$ hadrons with a given charge by considering all the ways to arrange one hadron multiplied by all the ways to arrange the remaining hadrons. To avoid double counting, a factor of $1/A$ is applied. For a fixed charge the probability to have $A$ hadrons is,
\begin{eqnarray}
P(A)&=&\frac{Z_A(Q,B,S)}{\sum_A Z_A(Q,B,S)}=\frac{Z_A(Q,B,S)}{Z(Q,B,S)}.
\end{eqnarray}
In practice, the sum over $A$ is cut off at some $A_{\rm max}$, but in our studies here that cutoff is made large enough that contributions to $Z$ for $A>A_{\rm max}$ are negligible. Thus, once one builds the partition function from $A=0$ to $A_{\rm max}$ one has the partition function for all $Q,B,S$. 

Once the partition function is calculated one can also calculate the multiplicities and moments of observing specific species. For example, the multiplicity of species $h$ in a system with charge $Q,B,S$ is
\begin{eqnarray}
\langle N_h\rangle &=& z_h\frac{Z(Q-q_h,B-b_h,S-s_h)}{Z(Q,B,S)}.
\end{eqnarray}
This also provides expressions for the various charges, e.g.,
\begin{eqnarray}
\langle Q\rangle &=& \sum_h q_hz_h\frac{Z(Q-q_h,B-b_h,S-s_h)}{Z(Q,B,S)}.
\end{eqnarray}
Spectra can also be calculated
\begin{eqnarray}
\frac{dN_h}{d^3p}&=&\frac{(2\mathfrak{s}_h+1)\Omega}{(2\pi\hbar)^3}e^{-E_h(p)}\frac{Z(Q-q_h,B-b_h,S-s_h)}{Z(Q,B,S)}.
\end{eqnarray}
Higher moments can also be extracted,
\begin{eqnarray}
\langle N_hN_{h'}\rangle &=& \delta_{hh'}z_h\frac{Z(Q-q_h,B-b_h,S-s_h)}{Z(Q,B,S)}+z_hz_{h'}\frac{Z(Q-q_h-q_{h'},B-b_h-b_{h'},S-s_h-s_{h'})}{Z(Q,B,S)}.
\end{eqnarray}
It is straightforward to extend this expression to higher-order fluctuations.

These expressions can also be extended to consider non-additive conservation laws. Net isospin conservation of a hadron gas was invoked in \cite{Cheng:2002jb}, i.e. restricting the states to being in an iso-singlet.  Quark-gluon states restricted to being in both an iso-singlet and a color singlet were addressed in \cite{Pratt:2003jd}. Bose and Fermi corrections are discussed in Sec. \ref{sec:bose}.

For the case of a single kind of charge, one can see how the the recursive method above yields the same result as what one would expect by writing down the partition function for a system with $(A-Q)/2$ negative charges and $(A+Q)/2$ positive charges as shown in \cite{Savchuk:2019xfg},
\begin{eqnarray}
\label{eq:singlecharge}
Z_{A,Q}=\left\{\begin{array}{rl}
\frac{z^A}{[(A-Q)/2]![(A+Q)/2]!},&A-Q~{\rm is~even},\\
0,&A-Q~{\rm is~odd}.\end{array}\right. ,
\end{eqnarray}
where $z$ is the partition function of a single charge. One can readily see that this is consistent with the recurrence relations,
\begin{eqnarray}
Z_{A,Q}&=&\frac{z}{A}\left\{Z_{A-1,Q-1}+Z_{A-1,Q+1}\right\}\\
\nonumber
&=&\frac{z}{A}\left\{\frac{z^{A-1}}{[(A-Q-2)/2]![(A+Q)/2]!}+\frac{z^{A-2}}{[(A-Q)/2]![(A+Q-2)/2]!}\right\}\\
\nonumber
&=&\frac{z}{A}\left\{\frac{z^{A-1}(A-Q)/2}{[(A-Q)/2]![(A+Q)/2]!}+\frac{z^{A-2}(A+Q)/2}{[(A-Q)/2]![(A+Q)/2]!}\right\}\\
&=&\frac{z^A}{[(A-Q)/2]![(A+Q)/2]!}.
\end{eqnarray}
This result is also equivalent to expectations based on setting reaction rates equal. If one assumes that pairs are created with some rate $\beta$, and that they are destroyed with some rate $\alpha N_+N_-$, where $N_+$ and $N_-$ are the number of positive and negative charges, $N_++N_-=A$. Setting the rates equal,
\begin{equation}\label{eq:ratesequal}
\alpha \frac{(A-Q)(A+Q)}{4}Z_{A,Q}=\beta Z_{A-2,Q}.
\end{equation}
One can see that if one chooses $\beta/\alpha=z$ that Eq.s (\ref{eq:ratesequal}) and (\ref{eq:singlecharge}) are consistent. If the net charge is zero, the result is even simpler,
\begin{eqnarray}
\label{eq:PAgivenQcanonical}
P(A|Q)&=&\frac{Z_{A,Q}}{\sum_A Z_{A,Q}},\\
\nonumber
P(A|Q=0)&=& \frac{z^A}{[(A/2)!]^2}\left\{\sum_{A={\rm even}} \frac{z^A}{[(A/2)!]^2}\right\}^{-1}.
\end{eqnarray}

Aside from the assumptions that $Q$ is fixed and that there exists only one kind of charge, Eq.(\ref{eq:ratesequal}) also requires that Bose and Fermi quantum statistical corrections are negligible, and that only unit charges exist. Despite these shortcomings, this picture is useful in that it allows one to see how multiplicity fluctuations are affected by charge conservation in a simple model. 
